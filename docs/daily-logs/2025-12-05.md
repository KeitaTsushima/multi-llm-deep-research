# 2025-12-05

## Session Info

- Branch: main â†’ feature/plan-01-llm-clients

## What I Did

### Session 1: Initial Setup

- âœ¨ Created new repository from project-templates
- ðŸ“ Wrote all project documentation (README, project-overview, architecture)
- ðŸ“„ Created research templates (research-request, meta-review, final-report)
- âš™ï¸ Set up GitHub Actions CI (ruff + mypy)
- ðŸ—ï¸ Created source skeleton (src/mldr/)
- ðŸ”§ Configured GitHub branch protection + CodeRabbit

### Session 2: Architecture Review & Version Roadmap

- ðŸ“ Reviewed external feedback on architecture design
- ðŸ”§ Added v0.5/v1.0 version roadmap to architecture.md
- âž• Added CLI `--models` option specification
- ðŸ“‹ Added Implementation Note to prevent premature v1 feature implementation

### Session 3: PLAN-01 Creation (Config & LLM Clients)

- ðŸŒ¿ Created feature branch `feature/plan-01-llm-clients`
- ðŸ“ Created initial PLAN-01-llm-clients.md
- ðŸ”„ Iterated through 3 rounds of external feedback
- âœ… Finalized PLAN aligned with architecture.md and v0.5 scope

## Implementation Details

### Documentation

**Files created/modified**:
- `README.md` â€” Project overview for external readers
- `docs/project-overview.md` â€” Purpose, goals, tech stack, workspace/output design
- `docs/architecture.md` â€” Module responsibilities, interfaces, CLI spec

### Templates

**Files created**:
- `templates/research-request.md` â€” Generic research specification template
- `templates/meta-review.md` â€” Structural + interpretive meta-review instructions
- `templates/final-report.md` â€” Final synthesis report structure

### CI Setup

**Files created**:
- `.github/workflows/ci.yml` â€” Runs ruff and mypy on push/PR
- `requirements.txt` â€” ruff, mypy

### Version Roadmap (Session 2)

**Files modified**:
- `docs/architecture.md` â€” Added Section 5 "Design Principles & Version Roadmap"

**Changes made**:
1. **CLI `--models` option** (Section 3.2)
   - Added `--models gpt,claude` option to `mldr run` command
   - Enables model selection for development and cost control

2. **Section 5 rewrite**: Replaced "Roadmap Hooks" with "Design Principles & Version Roadmap"
   - **5.1 v0.5 Scope**: Fault tolerance, model selection, Markdown-only, full-context meta review
   - **5.2 v1.0 Extensions**: Structured output, Map-Reduce, Evidence extraction, Critic loop, Async
   - **5.3 Principle Summary**: v0.5 = correctness/stability, v1.0 = structure/scalability
   - **5.4 Legacy Roadmap Hooks**: Preserved original content

3. **Implementation Note** added after Section 5.3
   - Explicit instruction for contributors and LLMs to follow v0.5 scope only
   - Lists v1 features that must NOT be implemented in v0.5

### Source Skeleton

**Directory structure**:

```text
src/mldr/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py
â”‚   â”œâ”€â”€ llm_clients.py
â”‚   â”œâ”€â”€ prompts.py
â”‚   â””â”€â”€ pipeline.py
â””â”€â”€ cli/
    â”œâ”€â”€ __init__.py
    â””â”€â”€ main.py
```

### PLAN-01: Config & LLM Clients (Session 3)

**File created**: `docs/plans/PLAN-01-llm-clients.md`

**Scope**:
- `config.py`: `ModelId`, `ModelConfig`, `Config`, `load_api_keys()`, `default_config()`
- `llm_clients.py`: `LLMResult`, `LLMClient` Protocol, `build_clients()`
- Required clients: OpenAI (GPT), Anthropic (Claude)
- Stub clients: Gemini, Perplexity, Grok (`NotImplementedError`)

**Key design decisions documented**:
1. `Config` has named fields for each model (`config.gpt`, `config.claude`, etc.)
2. Access via `config.get_model_config(model_id)` helper for type-safe access
3. `build_clients()` fail-fast: raises exception if API key missing for enabled model
4. `default_config()` returns `primary_models = ["gpt", "claude"]` only (v0.5 scope)
5. v0.5 is synchronous only; async via separate `AsyncLLMClient` in v1.x
6. SDK version pins: `openai>=1.0.0,<2.0.0`, `anthropic>=0.3.0,<1.0.0`

**Feedback iterations**:
1. Initial draft â†’ Architecture misalignment (get_client vs build_clients, LLMResponse vs LLMResult)
2. Revision 1 â†’ v0.5 scope too broad (5 clients vs 2 required)
3. Revision 2 â†’ Config field structure and build_clients failure behavior clarified
4. Revision 3 â†’ Added async design note, get_model_config() helper, SDK version pins

## Decisions Made

### Workspace & Output Directory Design

- **Decision**: Keep all research data (inputs/outputs) outside the repository
- **Rationale**: Reproducibility + prevent accidental leakage of confidential data
- **Paths**: `~/Documents/mldr/workspace/` and `~/Documents/mldr/output/`

### Package Name

- **Decision**: Use `mldr` as package name
- **Rationale**: Short, easy to type for CLI usage

### v0 Meta-Review Model Assignment

- **Decision**: GPT = structural, Claude = interpretive (hardcoded in v0)
- **Rationale**: Simplicity for v0; can be made configurable in future versions

### CI Scope

- **Decision**: Only ruff + mypy for v0 (no pytest, no black)
- **Rationale**: No tests yet; avoid formatting friction during initial development

### v0.5 vs v1.0 Scope Separation (Session 2)

- **Decision**: Clearly separate v0.5 (minimal viable) from v1.0 (structured, scalable)
- **Rationale**: External review identified risk of scope creep; v0.5 must be small, reliable, and easy to validate
- **v0.5 must-haves**: Fault tolerance (1 model failure â‰  pipeline failure), model selection via CLI, Markdown-only output
- **v1.0 deferred**: Structured output (JSON), Map-Reduce compression, Evidence extraction, Critic loop, Async execution

### Implementation Note for LLMs (Session 2)

- **Decision**: Add explicit "do NOT implement v1 features" instruction in architecture.md
- **Rationale**: Prevent Claude from "deep reading" v1 extensions and implementing them prematurely

## ðŸ“ Git Commit History

**Branch**: `main`
1. `21b378f` - v0: Project outline with docs, templates, CI, and source skeleton
2. `b43c290` - docs: Add v0.5/v1.0 version roadmap and CLI --models option

**Branch**: `feature/plan-01-llm-clients`
3. `4e94c47` - docs: Add PLAN-01 for config.py and llm_clients.py
4. `ba1494d` - docs: Add async design note, get_model_config(), version pins to PLAN-01

## ðŸ§ª Testing Results

### CI Verification

**Expected**: ruff and mypy pass on skeleton
**Result**:

```text
ruff check src â†’ All checks passed!
mypy src/mldr â†’ Success: no issues found in 8 source files
```

âœ… CI green on GitHub Actions

## Next Steps

- [x] Create PLAN for v0.5 implementation (PLAN-01 done)
- [ ] Implement config.py skeleton (Phase 2)
- [ ] Implement llm_clients.py skeleton (Phase 2)
- [ ] Implement config.py functions (Phase 3)
- [ ] Implement llm_clients.py clients (Phase 3)
- [ ] Write unit tests
- [ ] Create PLAN-02 for prompts.py
- [ ] Create PLAN-03 for pipeline.py
- [ ] Create PLAN-04 for CLI

## Notes for Future

- CodeRabbit only activates on PRs, not direct pushes to main
- Branch protection bypass works for admin (self-approval not needed)
- All docs now use consistent path examples: `~/Documents/mldr/workspace/` and `~/Documents/mldr/output/`
